GameManager設計

GameManagerクラス

  マップの情報を管理する。
  モンスターのリストを保持する。
  アイテムのリストを保持する。

GameManagerクラスをインスタンス化し、
プレイヤーインスタンスのフィールドにセットする。
このことにより、
マップ・モンスター・アイテムがプレイヤーごとに
個別のものとしてプレイされるようになる。
これは、コマンドアプリでは関係ないが、将来
Webアプリにすることを予想している。

また、モンスターのリストをGameManagerが保持することにより、
プレイヤーがモンスターと戦い、いったん中止して、移動して
また、元の場所に戻って再度戦うとき、さっきの続きから戦う
ことができる。

これは、マップの設計に関係する。


マップの設計

char型の二次元配列とする。
'.' -- 何もない
'g' -- ゴブリン
's' -- スライム
'p' -- ポーション
1つの場所に複数の char は置けない。

プレイヤーはマップ配列の中には入れない。
自由に移動するためである。

(別のやり方)
このマップを Character型の二次元配列とすることも可能。
Character型は、Monster型とItem型の親クラスと考える。
char型のマップだと、たとえば 'g' という文字に出会ったら、
Gobiln型のモンスターを呼び出すことになるが、
Character型のマップだと、そのような手間がいらない。

(モンスターの登場のさせ方)
char型のマップの場合、モンスターの登場のさせ方に次の2通りがある。

(1) 'g' に出会ったら、new Goblin() として、ゴブリンインスタンスを
  生成し、それと戦うという方法。
  この場合、戦いを中断してプレイヤーが移動して、また元の場所に
  戻った場合、さっきのゴブリンインスタンスは消滅して、また別の
  ゴブリンインスタンスと戦うということになる。
  あるいは、戦いの中断ができないようにする。

(2) たとえば ゴブリンインスタンスをあらかじめ生成しておいて、
  GameManagerインスタンスに保持させておく。そして、'g' と
  出会ったら、そのゴブリンインスタンスと戦うという方法。
  これだと、戦いの中断は簡単にできる。元の場所に戻ったら、
  さっきのゴブリンインスタンスと戦いの続きをすることができる。


GameManagerクラス

フィールド
  YSIZE    :int            マップの縦の大きさ
  XSIZE    :int            マップの横の大きさ
  map      :char[][]       マップ
  monsters :List<Monster>  モンスターが倒れたら、リストから削除する。
  items    :List<Item>     アイテムを使用したら、リストから削除する。
  
メソッド
  initMap() :void
          縦YSIZE、横XSIZE のマス目に '.' をセットする。
          これはコンストラクタから呼び出すようにしておくて、
          必ず実行される。
  setPosition(char) :void
          char型の文字をマップの中にランダムにセットする。
          重複配置はしない。
  printMap(Player) :void
          マップを表示する。プレイヤーは '@' で表示する。
  setMonster(Monster) :void
          モンスターを配置する。setPosition()を使う。
          GameManagerインスタンスのモンスターリストにモンスターを
          追加する。
  setItem(Item) :void
          アイテムを配置する。setPosition()を使う。
          GameManagerインスタンスのアイテムリストにアイテムを追加する。
  getMonster(char) :Monster
          マップ上で、'g' や 's' に出会ったときに、このメソッドで
          モンスターを呼び出す。
  getItem(char) :Item
          マップ上で、'p' に出会ったときに、このメソッドでアイテムを
          呼び出す。
  battle(Player) :void
          プレイヤーの位置から char文字を読み取り、そのモンスターを
          呼び出す。
          簡略化のため、プレイヤーからの攻撃とする。(プレイヤクラス
          の attack()メソッドを呼び出す)
          もし、モンスターが倒れたら、モンスターリストから削除し、
          マップ上も '.' に変更する。
          モンスターが倒れなかった場合、モンスターからの反撃となる。
          (モンスタークラスの attack()メソッド)
          その反撃によりプレイヤーが倒れたら、ゲームオーバーとなる。
  gameOber() :void
          ゲームオーバーの文字を画面に表示する。
          プログラムを終了させる。





;; 修正時刻: Sat 2025/11/22 07:13:07
